<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<head>
    <title>예약 상세 페이지</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <th:block layout:fragment="head"></th:block>
    <link rel="stylesheet" th:href="@{/css/bookingDetail.css}"/>
</head>

<body>
<div layout:fragment="content" class="booking-detail-container">

    <!-- 헤더: 뒤로가기 + 제목 -->
    <header class="booking-header">
        <button type="button" class="btn-back" onclick="history.back()">
            <i class="fas fa-arrow-left" aria-hidden="true"></i>
            <span class="sr-only">뒤로가기</span>
        </button>
        <h1 class="booking-title" th:text="${detail.isMember} ? '예약 상세' : '비회원 예약 상세'"></h1>
    </header>

    <!-- 예약 상태 -->
    <section class="status-box">
        <span th:if="${detail.status == 'CONFIRMED'}">예약확정</span>
        <span th:if="${detail.status == 'COMPLETED'}">이용완료</span>
        <span th:if="${detail.status == 'CANCELED'}">예약취소</span>

        <!-- 예약 확정 안내 -->
        <div th:if="${detail.status == 'CONFIRMED'}" class="status-note status-confirmed">
            <i class="fas fa-check-circle"></i>
            <p>
                예약이 확정되었어요. <span th:text="${detail.checkin}+ ' ' + ${detail.checkinDay}"></span> 15:00 부터 입실 가능합니다.
            </p>
        </div>

        <!-- 예약 취소 안내 -->
        <div th:if="${detail.status == 'CANCELED'}" class="status-note status-canceled">
            <i class="fas fa-exclamation-circle"></i>
            <p>
                예약이 취소되었어요. 환불은 주말/공휴일을 제외한 영업일 기준 3~5일 소요될 수 있어요.
            </p>
        </div>
    </section>

    <!-- 호텔 정보 -->
    <section class="hotel-info">
        <img th:src="@{${detail.hotelImage}}" alt="호텔 이미지" class="hotel-image"/>
        <div class="hotel-details">
            <h3 th:text="${detail.hotelName}"></h3>
            <p th:text="${detail.hotelAddress}"></p>
        </div>
    </section>

    <!-- 일정 & 객실 정보 -->
    <section class="room-info">
        <p>
            <strong>예약 일정:</strong>
            <span th:text="${detail.checkin} + ' ' + ${detail.checkinDay} + ' 15:00  ~ ' + ${detail.checkout} + ' ' + ${detail.checkoutDay} + ' 11:00'"></span>
            /
            <span th:text="${#numbers.formatInteger(T(java.time.temporal.ChronoUnit).DAYS.between(detail.checkin, detail.checkout), 0)} + '박'"></span>
        </p>
        <p>
            <strong>객실 타입:</strong>
            <span th:text="${detail.roomName}"></span>
        </p>
    </section>

    <hr/>

    <!-- 예약자 정보 -->
    <section class="booking-info">
        <h3>예약 정보</h3>
        <dl>
            <dt>예약번호</dt>
            <dd class="booking-number">
                <span th:text="${detail.merchantUid}" id="merchantUid"></span>
                <button type="button" class="btn-copy" onclick="copyMerchantUid()">복사</button>
            </dd>

            <dt>예약자 이름</dt>
            <dd th:text="${detail.buyerName}"></dd>

            <dt>휴대폰 번호</dt>
            <dd th:text="${detail.buyerTel.substring(0,3) + '-' + detail.buyerTel.substring(3,7) + '-' + detail.buyerTel.substring(7,11)}"></dd>
        </dl>
    </section>

    <hr/>

    <!-- 결제 정보 -->
    <section class="payment-info">
        <h3>결제 정보</h3>
        <dl>
            <dt>결제 일시</dt>
            <dd th:text="${#temporals.format(detail.createdAt, 'yyyy년 MM월 dd일 HH:mm')}"></dd>

            <dt>결제 수단</dt>
            <dd th:text="${detail.payMethod}"></dd>

            <dt>객실 가격</dt>
            <dd th:text="${#numbers.formatInteger(detail.roomPrice, 0, 'COMMA')} + '원'"></dd>

            <dt>숙박 일수</dt>
            <dd th:text="${#numbers.formatInteger(T(java.time.temporal.ChronoUnit).DAYS.between(detail.checkin, detail.checkout), 0)} + '박'"></dd>

            <dt>결제 금액</dt>
            <dd th:text="${#numbers.formatInteger(detail.paidAmount, 0, 'COMMA')} + '원'"></dd>
        </dl>
    </section>

    <!-- 예약 취소 -->
    <section class="cancel-info" th:if="${detail.status == 'CONFIRMED'}">
        <hr/>
        <div class="cancel-header" style="display: flex; justify-content: space-between; align-items: center;">
            <h3>예약 취소</h3>
            <button th:if="${detail.canCancel}" type="button" class="btn btn-cancel">
                예약취소
            </button>
        </div>

        <!-- 안내 메시지 -->
        <p th:if="${detail.canCancel}" class="cancel-message"
           th:text="${#temporals.format(detail.checkin.minusDays(1), 'yyyy년 MM월 dd일')} + ' 23:59까지 예약 취소 및 금액 환불이 가능합니다.'">
        </p>
        <p th:unless="${detail.canCancel}" class="cancel-message">
            예약 취소 및 금액 환불 가능한 시간이 이미 지났습니다.
        </p>
    </section>

    <!-- 스크립트 전달용 변수 -->
    <script th:inline="javascript">

        // 체크인 날짜 (취소 가능 여부 확인)
        const checkin = [[${detail.checkin}]];

        // 예약번호
        const merchantUid = [[${detail.merchantUid}]];

    </script>

    <script th:src="@{/javascript/bookingDetail.js}"></script>

</div>
</body>
</html>
