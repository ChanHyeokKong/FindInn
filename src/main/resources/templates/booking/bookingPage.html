<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<head>
    <title>호텔 예약 확인 및 결제</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <th:block layout:fragment="head"></th:block>
    <link rel="stylesheet" th:href="@{/css/booking.css}" />
</head>

<body>
<th:block layout:fragment="content">

    <div class="container">

        <h1>호텔 예약 확인 및 결제</h1>

        <div class="booking-wrapper">

            <!-- 왼쪽 영역: 예약자 정보 + 결제 수단 -->
            <div class="left-section">

                <!-- 예약자 정보 -->
                <section>
                    <h2>예약자 정보</h2>
                    <hr>
                    <form id="bookingForm" autocomplete="off">
                        <div class="form-group">
                            <label for="guestName">예약자 이름</label>
                            <input type="text" id="guestName" name="guestName" placeholder="홍길동" required>
                        </div>

                        <div class="form-group">
                            <label for="guestPhone">휴대폰 번호</label>
                            <input type="tel" id="guestPhone" name="guestPhone" placeholder="010-1234-5678" required>
                            <button type="button" id="sendAuthBtn" th:if="${!isLogined}">
                                인증번호 받기
                            </button>
                        </div>

                        <div id="authSection" style="display:none;">
                            <label for="authInput">인증번호 입력</label>
                            <input type="text" id="authInput" placeholder="인증번호 입력">
                            <input type="hidden" id="serverAuthCode" value="">
                            <button type="button" id="checkAuthBtn">확인</button>
                            <p id="timerText" style="color: gray;"></p>
                        </div>

                        <p id="authResultMsg"></p>
                    </form>
                </section>

                <!-- 결제 수단 -->
                <section>
                    <h2>결제 수단</h2>
                    <hr>
                    <div id="payMethodSection">
                        <button type="button" class="payMethodBtn selected" data-method="tosspay">토스페이</button>
                        <button type="button" class="payMethodBtn" data-method="kakaopay">카카오페이</button>
                        <button type="button" class="payMethodBtn" data-method="card">신용/체크카드</button>
                    </div>
                </section>

            </div>

            <!-- 오른쪽 영역: 객실 정보 + 결제 정보 -->
            <div class="right-section">

                <!-- 객실 정보 -->
                <section>
                    <h2>객실 정보</h2>
                    <hr>
                    <ul>
                        <li><strong>호텔명:</strong> <span th:text="${hotelName}">호텔명</span></li>
                        <li><strong>객실:</strong> <span th:text="${roomNameAndNum}">객실명 및 번호</span></li>
                        <li><strong>체크인:</strong> <span th:text="|${checkin} ${checkinDay}|">체크인</span></li>
                        <li><strong>체크아웃:</strong> <span th:text="|${checkout} ${checkoutDay}|">체크아웃</span></li>
                        <li><strong>기준인원:</strong> <span th:text="'최대 '+ ${capacity} + '인'">인원수</span></li>
                        <li><strong>추가정보:</strong> <span th:text="${description}">설명</span></li>
                    </ul>
                </section>

                <!-- 결제 정보 -->
                <section>
                    <h2>결제 정보</h2>
                    <hr>
                    <p>
                        객실 가격(<span th:text="${nights}">?</span>박):
                        <span th:text="${#numbers.formatInteger(price * nights, 0, 'COMMA')} + '원'">?원</span>
                    </p>
                    <p>
                        <strong>총 결제 금액:</strong>
                        <strong th:text="${#numbers.formatInteger(totalPrice, 0, 'COMMA')} + '원'">?원</strong>
                    </p>
                    <p>
                        <button id="payBtn">결제하기</button>
                    </p>
                </section>

            </div>

        </div>

        <!-- 스크립트 전달용 변수 -->
        <script th:inline="javascript">
            // 로그인 상태
            const isLogined = [[${isLogined}]];

            // sms 인증
            let isPhoneVerified = false;

            // 결제 수단
            let payMethod = 'tosspay';  // 초기값

            // 회원 id, email (비회원 시 null, test)
            const memberIdx = [[${memberIdx}]];
            const memberEmail = [[${memberEmail}]];

            // 객실 및 예약 정보
            const roomIdx = [[${roomIdx}]];
            const hotelImage = [[${hotelImage}]];
            const hotelName = [[${hotelName}]];
            const roomName = [[${roomName}]];
            const roomNameAndNum = [[${roomNameAndNum}]];
            const capacity = [[${capacity}]];
            const description = [[${description}]];
            const checkin = [[${checkin}]];
            const checkout = [[${checkout}]];
            const checkinDay = [[${checkinDay}]];
            const checkoutDay = [[${checkoutDay}]];
            const price = [[${price}]];
            const nights = [[${nights}]];
            const totalPrice = [[${totalPrice}]];

            // 포트원 채널키
            const channelKey = [[${channelKey}]];
        </script>

        <!-- 스크립트 -->
        <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
        <script th:src="@{/javascript/smsAuth.js}"></script>
        <script th:src="@{/javascript/payMethod.js}"></script>
        <script th:src="@{/javascript/payment.js}"></script>

    </div>

</th:block>
</body>

</html>
